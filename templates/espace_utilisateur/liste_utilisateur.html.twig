{% extends "base.html.twig" %}

{% block title %} Liste des utilisateurs {% endblock %}

{% block body %}
<script src="https://bootswatch.com/_vendor/jquery/dist/jquery.min.js"></script>
<div class="card bg-light mb-3" style="max-width: 20rem;">
        <div class="card-header">Tableau de bord de {{ app.user.username }}</div>
            <div class="card-body">
                <h4 class="card-title">Table des matières</h4>
                <p class="card-text">
                    <ul>
                        <li>Produits <i id="flecheF1" onclick="gestionTexte('element1', 'flecheF1')" style="cursor:pointer;">▼</i>
                            <div id="element1" style="display:none">
                                <ul>
                                    <li><a class="text-secondary"href="{{ path("produit_visite") }}">Les produits visités</a></li>
                                    <li><a class="text-secondary"href="{{ path("produit_notes") }}">Les produits notés</a></li>
                                    <li><a class="text-secondary"href="{{ path("produit_commentaires") }}">Les produits commentés</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>Forum <i id="flecheF2" onclick="gestionTexte('element2', 'flecheF2')" style="cursor:pointer;">▼</i>
                            <div id="element2" style="display:none">
                                <ul>
                                    <li><a class="text-secondary"href="{{ path("forum_visite") }}">Les sujets visités</a></li>
                                    <li><a class="text-secondary"href="{{ path("forum_discussion") }}">Mes sujets</a></li>
                                    <li><a class="text-secondary"href="{{ path("forum_participation") }}">Participations aux sujets</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>Amis <i id="flecheF3" onclick="gestionTexte('element3', 'flecheF3')" style="cursor:pointer;">▼</i>
                            <div id="element3" style="display:block">
                                <ul>
                                    <li><a class="text-succes"href="#">Liste des utilisateurs</a></li>
                                    <li><a class="text-secondary"href="{{ path("liste_amis") }}">Liste d'amis</a></li>
                                    <li><a class="text-secondary"href="{{ path("demandes") }}">Demandes en attentes</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </p>
            </div>
        </div>
    </div>

	<!-- Utilisation du sélecteur de pages de KNP -->
	
</div>
<div class="container">
    {% if app.user %}
        {% if demande is defined and demande is not empty %}
            <h3>Mes demandes en attente</h3><br>
            {{ knp_pagination_render(demande) }}
            {% for d in demande %}
                {% if d.recepteur.imagebase64 is not null %}
                    <img class="float-left" src="data:image/png;image/jpg;image/gif;base64, {{ d.recepteur.imagebase64 }}" style="width: 100px; height: 100px; border-radius : 75px;" data-toggle="dropdown" data-placement="bottom" title="{{ d.recepteur.username }}" alt="photo de profil"/>
                {% else %}
                    <i class="fas fa-user-circle fa-6x align-self-center float-left"></i>
                {% endif %}
                <h4>{{ d.recepteur.username }}</h4><br/>
                <em> {{ d.recepteur.username }} a reçu la demande, en attente de confirmation ! </em>
                <button type="button" class="btn btn-danger float-right" data-toggle="modal" data-target="#myModalSuppr{{ d.id }}">Retirer la demande <i class="fas fa-trash-alt"></i></button>
                <div class="modal" id="myModalSuppr{{ d.id }}">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fa fa-exclamation-circle text-danger"></i> Retirer la demande</h5>
                            </div>
                            <div class="modal-body">
                                <p>Etes-vous sûr de vouloir retirer la demande que vous avez envoyé à <b>{{ d.recepteur.username }}</b> ?</p>
                            </div>
                            <div class="modal-footer">
                                <form action="{{ path("supprimer_demande", {"id" : d.id}) }}">
                                    <button type="submit" class="btn btn-primary">Oui <i class="fa fa-check"></i></button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Non <i class="fa fa-times"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="my-5 border-info" />
            {% endfor %}
        {% endif %}
        {% if reception is defined and reception is not empty %}
            <h3>Mes demandes reçus</h3><br>
            {{ knp_pagination_render(reception) }}
            {% for r in reception %}
                {% if r.demandeur.imagebase64 is not null %}
                    <img class="float-left" src="data:image/png;image/jpg;image/gif;base64, {{ r.demandeur.imagebase64 }}" style="width: 100px; height: 100px; border-radius : 75px;" data-toggle="dropdown" data-placement="bottom" title="{{ r.demandeur.username }}" alt="photo de profil"/>
                {% else %}
                    <i class="fas fa-user-circle fa-6x align-self-center float-left"></i>
                {% endif %}
                <h4>{{ r.demandeur.username }}</h4><br/>
                <em>{{ r.demandeur.username }} vous a envoyé une demande d'ami !</em>
                <div class="form-group float-right">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModalAccept{{ r.id }}">Accepter <i class="fa fa-check"></i></button>
                    <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#myModalRefuse{{ r.id }}">Refuser <i class="fa fa-times"></i></button>
                </div>
                <div class="modal" id="myModalAccept{{ r.id }}">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fa fa-exclamation-circle text-danger"></i> Accepter la demande</h5>
                            </div>
                            <div class="modal-body">
                                <p>Etes-vous sûr de vouloir accepter la demande de <b>{{ r.demandeur.username }}</b> ?</p>
                            </div>
                            <div class="modal-footer">
                                <form action="{{ path("accepter_demande", {"id" : r.id}) }}">
                                    <button type="submit" class="btn btn-primary">Oui <i class="fa fa-check"></i></button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Non <i class="fa fa-times"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal" id="myModalRefuse{{ r.id }}">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fa fa-exclamation-circle text-danger"></i> Refuser la demande</h5>
                            </div>
                            <div class="modal-body">
                                <p>Etes-vous sûr de vouloir refuser la demande de <b>{{ r.demandeur.username }}</b> ?</p>
                            </div>
                            <div class="modal-footer">
                                <form action="{{ path("refuser_demande", {"id" : r.id}) }}">
                                    <button type="submit" class="btn btn-primary">Oui <i class="fa fa-check"></i></button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Non <i class="fa fa-times"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="my-5 border-info" />
            {% endfor %}
        {% endif %}
        {% if  utilisateurs|length >= 1 %}
            {{ knp_pagination_render(utilisateurs) }}
            <h3>Les Utilisateurs</h3><br>
            {% for u in utilisateurs %}
                {% if u.imagebase64 is not null %}
                    <img class="float-left" src="data:image/png;image/jpg;image/gif;base64, {{ u.imagebase64 }}" style="width: 100px; height: 100px; border-radius : 75px;" data-toggle="dropdown" data-placement="bottom" title="{{ u.username }}" alt="photo de profil"/>
                {% else %}
                    <i class="fas fa-user-circle fa-6x align-self-center float-left"></i>
                {% endif %}
                <h4>{{ u.username }}</h4><br/>
                <button type="button" class="btn btn-info float-right" data-toggle="modal" data-target="#myModalAjout{{ u.id }}">Envoyer une demande d'ami <i class="fa fa-paper-plane"></i></button>
                <div class="modal" id="myModalAjout{{ u.id }}">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fa fa-exclamation-circle text-danger"></i> Demande d'ami</h5>
                            </div>
                            <div class="modal-body">
                                <p>Etes-vous sûr de vouloir envoyer une demande à <b>{{ u.username }}</b> ?</p>
                            </div>
                            <div class="modal-footer">
                                <form action="{{ path("demande_ami", {"id" : u.id}) }}">
                                    <button type="submit" class="btn btn-primary">Oui <i class="fa fa-check"></i></button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Non <i class="fa fa-times"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="my-5 border-info" />
            {% endfor %}
        {% endif %}
    {% endif %}
</div>
{% endblock %}